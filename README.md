# Football Player Detection and Tracking

## Overview
This project focuses on detecting football players in video frames, tracking their movements, and assigning attributes such as team affiliation and ball possession. The final output is a video with annotations showing the players, teams, ball control, and movement statistics like speed and distance.

The project utilizes a pre-processed football dataset, **sourced from Roboflow**, which is fine-tuned for detecting football players and other game elements. The detection model is further refined using clustering techniques, specifically **KMeans clustering**, to differentiate between players, the ball, and other field objects.

## Project Structure

- **`fine-tuning-yolov5.ipynb`**: Handles the detection of players in video frames using clustering techniques like **KMeans clustering** to identify and classify different objects on the field. It assigns the team colors and detects non-player clusters in the frames. The fine tuned model gives a .pt file which we use in the other notebook for player, referee and football detection on the pitch
  
- **`Football_player_speed_and_distance_script.ipynb`**: Main processing pipeline. Processes each frame of the football match, assigns team colors, tracks ball possession, estimates camera movement, and calculates speed and distance covered by the players. This script uses the **Roboflow** dataset and a pre-trained model for object tracking, followed by post-processing to add detailed annotations to the final video output.

- **`enhanced_output.mp4`**: The final video generated by the project that contains all the processed information, including:
  - Player identification and team assignments
  - Ball possession tracking
  - Speed and distance traveled by players
  - Camera movement estimation

## Dataset

The dataset used for training and fine-tuning the detection models was sourced from **Roboflow**, a popular platform for computer vision datasets. The dataset includes labeled data of football players, the ball, and other objects relevant to the match. This dataset was crucial for training the detection models to achieve accurate results in real-time football video processing.

## Workflow and Key Components

### 1. Player Detection and Clustering
- The `fine-tuning-yolov5.ipynb.ipynb` notebook implements player detection using **KMeans clustering**.
- **KMeans Clustering**: This algorithm groups similar pixels in the frame to detect players, distinguish non-player areas (like the field), and classify the rest as players. The non-player clusters (background) are identified by analyzing the corners of the field, while player clusters are identified based on centroid locations and pixel values.

### 2. Team Assignment
- The `TeamAssigner` class assigns players to their respective teams based on uniform color. The KMeans clustering results are further refined to group players based on their team colors.
- Color distribution analysis is used to assign players to their closest matching team.

### 3. Ball Tracking and Possession
- The `PlayerBallAssigner` class assigns the ball to a specific player by checking the proximity of players to the ballâ€™s bounding box in each frame.
- This information is tracked across frames to identify which player and team have ball possession.

### 4. Camera Movement Estimation
- Camera movement is tracked to account for panning or zooming during the match. This ensures that player positions are accurately translated even with changing camera angles.

### 5. Speed and Distance Calculation
- The speed and distance traveled by each player are calculated by analyzing the changes in their positions across consecutive frames.

### 6. Video Output
- The processed video frames are compiled into the final video, `enhanced_output.mp4`, which includes all the annotations such as team, ball control, speed, distance, and camera movement.

## Installation

To run the project locally, install the required dependencies:

```bash
pip install opencv-python numpy scikit-learn keras tensorflow matplotlib

```
## Usage

To generate an annotated football video:

1. Clone this repository and install the required dependencies.
2. Prepare your video input as football match footage.
3. Download the **Roboflow dataset** and fine-tune the detection model.
4. Run the `Copy_of_Football_training_script.ipynb` notebook to process the video.
5. The final output will be saved as `enhanced_output.mp4`, which will include player and ball tracking annotations.

## Key Results

- The project successfully detects and tracks football players in a match, assigns them to teams, and identifies ball possession using **KMeans clustering** and the **Roboflow** dataset.
- Speed and distance traveled by players are computed and visualized.
- The final output video provides an enhanced viewing experience by overlaying key information about the game.

## Future Improvements

- **Improved Player Detection**: Current methods rely on KMeans clustering, which can be improved by integrating a state-of-the-art object detection model like YOLO for more robust results.
- **Ball Trajectory Prediction**: Predicting the ball's trajectory could enhance the analysis by showing potential future positions of the ball.
- **Real-time Processing**: Optimizing the processing pipeline to work in real-time would make this system useful for live match analysis.

## Video Output

The final output video is saved as `enhanced_output.mp4`, which shows the enhanced football match with the following annotations:
- Player tracking and team assignment.
- Ball possession tracking.
- Speed and distance covered by players.
- Camera movement estimation.
- This is how the final results look like
![image](https://github.com/user-attachments/assets/591c9829-070a-4661-b659-37d5461b11fc)

